# Custom Kubernetes 调度插件

## 简介
这是一个自定义的 Kubernetes 调度插件，主要用于配合 Longhorn 的 local-path 存储插件使用。该插件可以确保 Pod 只会被调度到已经配置了本地存储路径的节点上，从而优化存储资源的使用。

## 功能特点
- 自动过滤没有配置默认存储路径的节点
- 支持通过 ConfigMap 动态配置允许的节点和存储路径
- 提供节点评分机制，优先选择具有更多可用存储路径的节点
- 实时配置更新，无需重启调度器

## 工作原理
该插件实现了以下 Kubernetes 调度框架接口：

1. **PreFilter**: 
   - 预先检查集群中是否有可用节点
   - 验证是否存在配置了存储路径的节点
   - 如果没有合适的节点，将阻止调度过程

2. **Filter**:
   - 根据配置过滤不符合条件的节点
   - 只允许 Pod 调度到已配置存储路径的节点上

3. **Score**:
   - 对通过过滤的节点进行评分
   - 具有更多可用存储路径的节点将获得更高的评分
   - 默认基础分为 50 分，每个额外的存储路径增加 10 分

4. **Reserve/Unreserve**:
   - 处理节点资源的预留和释放
   - 确保调度决策的原子性

## 配置说明
插件通过 ConfigMap 进行配置，默认配置如下：
- ConfigMap 名称：`local-path-config`
- 命名空间：`kube-system`
- 配置键：`config.json`

可以通过修改 ConfigMap 来动态更新配置，无需重启调度器。

## 使用场景
- 当您使用 Longhorn 的 local-path 存储插件时
- 需要确保 Pod 只调度到具有本地存储能力的节点上
- 想要优化存储资源分配的场景

## 注意事项
1. 确保在使用此插件前正确配置 ConfigMap
2. 如果没有节点配置默认存储路径，Pod 将无法被调度
3. 插件会在每次调度时重新加载配置，确保使用最新的配置信息
